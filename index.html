<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M5 Stamp S3 BLE コントローラ</title>
    
    <link rel="manifest" href="manifest.json">
    <script>
        // Service Workerの登録（オフライン対応）
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js') 
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
  
    <link rel="stylesheet" href="style.css">


</head>
<body>
    <h1>M5 Stamp S3 BLE コントローラ
      <div class="controls">
        <button id="connectButton" class="connect">🛜デバイスに接続🛜</button>
        <div id="status" class="status">未接続</div>
        <div id="deviceName" class="device-info"></div>
    </div>

    </h1>

 <div class="main-container">
  <div class="column left-column">
    <div class="log-area">
        <h2>🗨️デバイスからのメッセージ📟📩
        <button id="clearLogButton">ログをクリア</button>
        </h2>
        <textarea id="log" rows="10" readonly></textarea>
    </div>
    
    <hr>



    <div class="auto-controls2">
        <label for="cmd-selectbar">指示 コマンド:</label>
        <select id="cmd-select" name="value">
         <option value=""selected>-- コマンドを選択してください --</option>
             
            <optgroup label="   --自動走行🚗--   "></optgroup>
            <option value="atl">🔝🔝自動走行 手前から(atl)</option>
            <hr>
            <option value="atr">🔚🔚自動走行 奥から(atr)</option>
            </optgroup>
            <hr>
            <hr>
            <optgroup label="  --オプション--  "></optgroup>

            <option value="dows">🔻少し下げる秒数指定(dows)(例0.5)</option>
            <hr>
            <option value="setd">🔃自動降下量設定(setd)(例0.5)</option>
            </optgroup>
            <hr>
            <hr>
            <optgroup label="  --単体動作--  "></optgroup>
            <option value="22">🔚手前走行(単体)(22)</option>
            <hr>
            <option value="21">🔝奥に走行(単体)(21)</option>
            <hr>
            <option value="11">👆上昇(単体)(11)</option>
            <hr>
            <option value="12">👇下降(単体)(12)</option>
            <hr>
            <option value="99">⚠緊急停止(単体)(93)</option>
            </optgroup>
            <optgroup label="  --CMD特殊--  "></optgroup>
            <hr>
            <option value="showlog">ログの更新</option>
            </optgroup>

        </select>

      <label for="secnumInputbar"><br>移動 秒数を入力(S):</label>
        <input type="number" id="secnumInput" name="value"placeholder="例：150や0.5など">

      <label for="cyclenumInputbar"><br>往復回数を入力:</label>
        <input type="number" id="cyclenumInput" name="value"placeholder="例：15">
        <button id="sendAutoCmdButton2" class="send-btn2">コマンド送信</button>
        <h2>🔄↑↑自動走行コマンド🔄</h2>
    </div>

   </div>  
   
   <div class="column right-column">
    <div class="manual-control">
        <h2>🤚手動操作🤚 ⌨(テンキー対応)</h2>
        <div class="wasd-grid">
            <button id="W" data-cmd="11" class="action-btn">8 <br>🔼(上昇)🔼</button>
            <div></div>
            <button id="key5" data-cmd="93" class="action-btn stop"data-key="5">5 <br>⛔(全停止)⛔</button>
            <button id="A" data-cmd="22" class="action-btn">4 <br>(手前走行)</button>            
            <button id="S" data-cmd="12" class="action-btn">2 <br>🔽(下降)🔽</button>          
            <button id="D" data-cmd="21" class="action-btn">6 <br>(奥に走行)</button>
        </div>
        
        <p class="stop-note">キーを離したときと同様に、停止するには下の 'Z' ボタンを押してください。</p>
        <div class="stop-controls">      
            <button id="E" data-cmd="99" class="action-btn emergency">0 <br>⚠⚠(緊急停止)⚠⚠</button>
        </div>
    </div>
    <div class="auto-control">
        <input type="text" id="autoCmdInput" placeholder="例: atr 10 s 2 c 10 b 10 d" autocomplete="on">
        <button id="sendAutoCmdButton" class="send-btn">CMD用</button>
        <button id="stopAtButton" data-cmd="STOPAT" class="send-btn stop">次の折返しで停止</button>
    </div>
  </div>
 </div>

    <script src="script.js"></script>
</body>
</html>