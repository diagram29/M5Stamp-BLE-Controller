<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M5 Stamp S3 BLE コントローラ</title>
    
    <link rel="manifest" href="manifest.json">
    <script>
        // Service Workerの登録（オフライン対応）
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js') 
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
  
    <link rel="stylesheet" href="style.css">


</head>
<body>
    <h1>M5 Stamp S3 BLE コントローラ
      <div class="controls">
        <button id="connectButton" class="connect">🛜デバイスに接続🛜</button>
        <div id="status" class="status">未接続</div>
        <div id="deviceName" class="device-info"></div>
    </div>

    </h1>





    





 <div class="main-container">
  <div class="column left-column">
    <div class="log-area">
        <h2>🗨️機械からのメッセージ！📟📩
        <button id="clearLogButton">ログをクリア</button>
        <button id="openLogViewerButton">過去ログ表示</button> 
        <button id="downloadLogButton">ログをダウンロード</button>
        </h2>
        <textarea id="log" rows="10" readonly></textarea>
    </div>
    


   </div>  




   
   <div class="column right-column">

      <div class="tabs-container">
       <div class="tab-buttons">
        <button class="tab-button active" onclick="openTab(event, 'manual-control')">🤚手動操作だよ</button>
        <button class="tab-button" onclick="openTab(event, 'auto-controls2')">🔄自動走行など</button>
        <button class="tab-button" onclick="openTab(event, 'content-c')">ヘルプ！</button>
       </div>

     <div class="tab-content-wrapper">
    
    
    <div id="manual-control" class="manual-control tab-content active">
      <h3>🤚手動操作だよ！🤚⌨(テンキー対応)</h3>
      <div class="wasd-grid">
            <button id="W" data-cmd="11" class="action-btn">8 <br>🔼(上昇)🔼</button>
            <div></div>
            <button id="key5" data-cmd="93" class="action-btn stop"data-key="5">5 <br>⛔(全停止)⛔</button>
            <button id="A" data-cmd="22" class="action-btn">4 <br>(手前走行)</button>            
            <button id="S" data-cmd="12" class="action-btn">2 <br>🔽(下降)🔽</button>          
            <button id="D" data-cmd="21" class="action-btn">6 <br>(奥に走行)</button>
            <button id="C" data-cmd="dows0.5" class="action-btn">3 <br>(0.5秒下げる)</button>
        </div>
         <p class="stop-note"> </p>
        <div class="stop-controls">      
            <button id="E" data-cmd="99" class="action-btn emergency">0 <br>⚠⚠(緊急停止)⚠⚠</button>
        </div>
    </div>




    <div id="auto-controls2" class="auto-controls2 tab-content">
      <h3>🔄自動走行と他操作</h3>
      <label for="cmd-selectbar">やらせたいこと:</label>
        <select id="cmd-select" name="value">
         <option value=""selected>-- ここをタップして指示を選んでね --</option>
             
            <optgroup label="   --自動走行🚗--   "></optgroup>
            <option value="atl">🔝🔝自動走行 手前から開始(atl)</option>
            <hr>
            <option value="atr">🔚🔚自動走行 奥から開始(atr)</option>
            </optgroup>
            <hr>
            <hr>
            <optgroup label="  --オプション--  "></optgroup>

            <option value="dows">🔻ちょっと下げ秒数指定できるよ(dows)(例0.5)</option>
            <hr>
            <option value="setd">🔃自動走行の降下量の設定～(setd)(例0.5)</option>
            </optgroup>
            <hr>
            <hr>
            <optgroup label="  ↓--単一動作--↓  "></optgroup>
            <option value="22">🔚手前に走る(22)</option>
            <hr>
            <option value="21">🔝奥に走る(21)</option>
            <hr>
            <option value="11">👆上昇する(11)</option>
            <hr>
            <option value="12">👇下降する(12)</option>
            <hr>
            <hr>
            <option value="30">⚠ノコを回す(30)周囲に注意</option>
            <hr>
            <option value="31">⚠ノコ、停止⚠(31)</option>
            <hr>
            <option value="99">⚠緊急停止(EMG)(93)</option>
            </optgroup>
            <optgroup label="  --CMD特殊--  "></optgroup>
            <hr>
            <option value="showlog">ログの更新</option>
            </optgroup>

        </select>

      <label for="secnumInputbar"><br>移動 秒数を入力(S):</label>
        <input type="number" id="secnumInput" name="value"placeholder="例：150や0.5など">

      <label for="cyclenumInputbar"><br>往復回数を入力:</label>
        <input type="number" id="cyclenumInput" name="value"placeholder="例：15">
        <button id="sendAutoCmdButton2" class="send-btn2">コマンド送信</button>
    </div>

    <div id="content-c" class="tab-content">
      <h3>help!!</h3>
      <p>-- 自動走行システム ヘルプ --<br>
        下降設定値は現在0.5秒です。<br>
        -- オートパイロット (atlan) --<br>
          <br>
        起動は以下のように記述してください。<br>
         例: atl15s10c<br>
          左から右へ片道15秒、往復10サイクル<br>
          <br>
         頭文字atでモード判断、L/Rで始動位置を指定します<br>
           秒数(s)で移動距離、サイクル数(c)で繰り返しを認識します。<br>
            <br>
            -- その他コマンド --<br>
             setdx: 下降値を変更 (例: setd0.3x)<br>
             dowsx: 設定秒数降下 (例: dows0.8x)<br>
             入力はすべて半角英数字です。</p>
    </div>
  </div>
       </div>


    



    <div class="auto-control">
        <input type="text" id="autoCmdInput" placeholder="例: atr 10 s 2 c 10 b 10 d" autocomplete="on">
        <button id="sendAutoCmdButton" class="send-btn">CMD用</button>
        <button id="stopAtButton" data-cmd="STOPAT" class="send-btn stop">次の折返しで停止</button>
    </div>


  </div>



 </div>

    <script src="script.js"></script>
</body>
</html>